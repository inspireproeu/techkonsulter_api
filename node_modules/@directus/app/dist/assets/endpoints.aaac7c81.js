import{a as l,o as r,b as o,w as c,g as s,B as e}from"./runtime-core.esm-bundler.b1f35d24.js";var n={};const i=s("div",{class:"markdown-body"},[s("blockquote",null,[s("p",null,"Custom API Endpoints register new API routes which can be used to infinitely extend the core functionality of the platform.")]),s("h2",{id:"extension-entrypoint"},[e("Extension Entrypoint "),s("a",{class:"header-anchor",href:"#extension-entrypoint"},"#")]),s("p",null,[e("The entrypoint of your endpoint is the "),s("code",{class:""},"index"),e(" file inside the "),s("code",{class:""},"src/"),e(" folder of your extension package. It exports a register function to register one or more custom routes. Each route of your endpoint will be a sub-route of "),s("code",{class:""},"/<extension-name>"),e(".")]),s("div",{class:"tip hint"},[s("div",{class:"hint-title"},"Extension Name"),s("p",null,"The extension name is usually the name of the folder where you put your extension when deploying it.")]),s("p",null,"Example of an entrypoint:"),s("pre",null,[s("code",{class:"language-js"},[s("span",{class:"hljs-keyword"},"export"),e(),s("span",{class:"hljs-keyword"},"default"),e(` (router) => {
	router.get(`),s("span",{class:"hljs-string"},"'/'"),e(", "),s("span",{class:"hljs-function"},[e("("),s("span",{class:"hljs-params"},"req, res"),e(") =>")]),e(" res.send("),s("span",{class:"hljs-string"},"'Hello, World!'"),e(`));
};
`)])]),s("p",null,"Alternatively, you can export a configuration object to be able to customize the root route:"),s("pre",null,[s("code",{class:"language-js"},[s("span",{class:"hljs-keyword"},"export"),e(),s("span",{class:"hljs-keyword"},"default"),e(` {
	`),s("span",{class:"hljs-attr"},"id"),e(": "),s("span",{class:"hljs-string"},"'greet'"),e(`,
	`),s("span",{class:"hljs-attr"},"handler"),e(": "),s("span",{class:"hljs-function"},[e("("),s("span",{class:"hljs-params"},"router"),e(") =>")]),e(` {
		router.get(`),s("span",{class:"hljs-string"},"'/'"),e(", "),s("span",{class:"hljs-function"},[e("("),s("span",{class:"hljs-params"},"req, res"),e(") =>")]),e(" res.send("),s("span",{class:"hljs-string"},"'Hello, World!'"),e(`));
		router.get(`),s("span",{class:"hljs-string"},"'/intro'"),e(", "),s("span",{class:"hljs-function"},[e("("),s("span",{class:"hljs-params"},"req, res"),e(") =>")]),e(" res.send("),s("span",{class:"hljs-string"},"'Nice to meet you.'"),e(`));
		router.get(`),s("span",{class:"hljs-string"},"'/goodbye'"),e(", "),s("span",{class:"hljs-function"},[e("("),s("span",{class:"hljs-params"},"req, res"),e(") =>")]),e(" res.send("),s("span",{class:"hljs-string"},"'Goodbye!'"),e(`));
	},
};
`)])]),s("p",null,[e("The routes of this endpoint are accessible at "),s("code",{class:""},"/greet"),e(", "),s("code",{class:""},"/greet/intro"),e(" and "),s("code",{class:""},"/greet/goodbye"),e(".")]),s("h4",{id:"available-options"},[e("Available Options "),s("a",{class:"header-anchor",href:"#available-options"},"#")]),s("ul",null,[s("li",null,[s("code",{class:""},"id"),e(" \u2014 The unique key for this endpoint. Each route of your endpoint will be a sub-route of "),s("code",{class:""},"/<id>"),e(".")]),s("li",null,[s("code",{class:""},"handler"),e(" \u2014 The endpoint\u2019s registration handler function.")])]),s("h2",{id:"register-function"},[e("Register Function "),s("a",{class:"header-anchor",href:"#register-function"},"#")]),s("p",null,[e("The register function receives the two parameters "),s("code",{class:""},"router"),e(" and "),s("code",{class:""},"context"),e(". "),s("code",{class:""},"router"),e(" is an Express router instance. "),s("code",{class:""},"context"),e(" is an object with the following properties:")]),s("ul",null,[s("li",null,[s("code",{class:""},"services"),e(" \u2014 All API internal services.")]),s("li",null,[s("code",{class:""},"exceptions"),e(" \u2014 API exception objects that can be used to throw \u201Cproper\u201D errors.")]),s("li",null,[s("code",{class:""},"database"),e(" \u2014 Knex instance that is connected to the current database.")]),s("li",null,[s("code",{class:""},"getSchema"),e(" \u2014 Async function that reads the full available schema for use in services")]),s("li",null,[s("code",{class:""},"env"),e(" \u2014 Parsed environment variables.")]),s("li",null,[s("code",{class:""},"logger"),e(" \u2014 "),s("a",{href:"https://github.com/pinojs/pino",target:"_blank",rel:"noopener noreferrer"},"Pino"),e(" instance.")]),s("li",null,[s("code",{class:""},"emitter"),e(" \u2014 "),s("a",{href:"https://github.com/directus/directus/blob/main/api/src/emitter.ts",target:"_blank",rel:"noopener noreferrer"},"Event emitter"),e(" instance that can be used to trigger custom events for other extensions.")])]),s("div",{class:"warning hint"},[s("div",{class:"hint-title"},"Event loop"),s("p",null,"When implementing custom events using the emitter make sure you never directly or indirectly emit the same event your hook is currently handling as that would result in an infinite loop!")]),s("h2",{id:"example%3A-recipes"},[e("Example: Recipes "),s("a",{class:"header-anchor",href:"#example%3A-recipes"},"#")]),s("pre",null,[s("code",{class:"language-js"},[s("span",{class:"hljs-keyword"},"export"),e(),s("span",{class:"hljs-keyword"},"default"),e(` (router, { services, exceptions }) => {
	`),s("span",{class:"hljs-keyword"},"const"),e(` { ItemsService } = services;
	`),s("span",{class:"hljs-keyword"},"const"),e(` { ServiceUnavailableException } = exceptions;

	router.get(`),s("span",{class:"hljs-string"},"'/'"),e(", "),s("span",{class:"hljs-function"},[e("("),s("span",{class:"hljs-params"},"req, res, next"),e(") =>")]),e(` {
		`),s("span",{class:"hljs-keyword"},"const"),e(" recipeService = "),s("span",{class:"hljs-keyword"},"new"),e(" ItemsService("),s("span",{class:"hljs-string"},"'recipes'"),e(", { "),s("span",{class:"hljs-attr"},"schema"),e(": req.schema, "),s("span",{class:"hljs-attr"},"accountability"),e(`: req.accountability });

		recipeService
			.readByQuery({ `),s("span",{class:"hljs-attr"},"sort"),e(": ["),s("span",{class:"hljs-string"},"'name'"),e("], "),s("span",{class:"hljs-attr"},"fields"),e(": ["),s("span",{class:"hljs-string"},"'*'"),e(`] })
			.then(`),s("span",{class:"hljs-function"},[e("("),s("span",{class:"hljs-params"},"results"),e(") =>")]),e(` res.json(results))
			.catch(`),s("span",{class:"hljs-function"},[e("("),s("span",{class:"hljs-params"},"error"),e(") =>")]),e(` {
				`),s("span",{class:"hljs-keyword"},"return"),e(" next("),s("span",{class:"hljs-keyword"},"new"),e(` ServiceUnavailableException(error.message));
			});
	});
};
`)])])],-1),p={title:"Custom API Endpoints",modularExtension:!0},u={name:"endpoints",setup(h,{expose:t}){return t({frontmatter:{title:"Custom API Endpoints",modularExtension:!0}}),(d,m)=>{const a=l("docswrapper");return r(),o(a,{frontmatter:p},{default:c(()=>[i]),_:1})}}};typeof n=="function"&&n(u);export{u as default,p as frontmatter};
