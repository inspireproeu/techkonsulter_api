import{a as o,o as r,b as l,w as i,g as s,B as a}from"./runtime-core.esm-bundler.b1f35d24.js";var e={};const c=s("div",{class:"markdown-body"},[s("blockquote",null,[s("p",null,[a("Directus allows adding custom migration files that run whenever the "),s("code",{class:""},"directus database migrate:*"),a(" commands are executed. All migrations must reside in the "),s("code",{class:""},"extensions/migrations"),a(" folder.")])]),s("h2",{id:"file-name"},[a("File Name "),s("a",{class:"header-anchor",href:"#file-name"},"#")]),s("p",null,"The file name follows the following structure:"),s("pre",null,[s("code",{class:""},`[identifier]-[name].js
`)]),s("p",null,"for example:"),s("pre",null,[s("code",{class:""},`20201202A-my-custom-migration.js
`)]),s("h2",{id:"structure"},[a("Structure "),s("a",{class:"header-anchor",href:"#structure"},"#")]),s("p",null,[a("Migrations have to export an "),s("code",{class:""},"up"),a(" and a "),s("code",{class:""},"down"),a(" function. These functions get a "),s("a",{href:"http://knexjs.org",target:"_blank",rel:"noopener noreferrer"},"Knex"),a(" instance that can be used to do virtually whatever.")]),s("pre",null,[s("code",{class:"language-js"},[s("span",{class:"hljs-built_in"},"module"),a(`.exports = {
	`),s("span",{class:"hljs-keyword"},"async"),a(),s("span",{class:"hljs-function"},[s("span",{class:"hljs-title"},"up"),a("("),s("span",{class:"hljs-params"},"knex"),a(")")]),a(` {
		`),s("span",{class:"hljs-keyword"},"await"),a(" knex.schema.createTable("),s("span",{class:"hljs-string"},"'test'"),a(", "),s("span",{class:"hljs-function"},[a("("),s("span",{class:"hljs-params"},"table"),a(") =>")]),a(` {
			table.increments();
			table.string(`),s("span",{class:"hljs-string"},"'rijk'"),a(`);
		});
	},

	`),s("span",{class:"hljs-keyword"},"async"),a(),s("span",{class:"hljs-function"},[s("span",{class:"hljs-title"},"down"),a("("),s("span",{class:"hljs-params"},"knex"),a(")")]),a(` {
		`),s("span",{class:"hljs-keyword"},"await"),a(" knex.schema.dropTable("),s("span",{class:"hljs-string"},"'test'"),a(`);
	},
};
`)])]),s("div",{class:"danger hint"},[s("div",{class:"hint-title"},"Danger"),s("p",null,"Seeing that these migrations are a bit of a free-for-all, you can really harm your database. Please make sure you know what you\u2019re doing and backup your database before adding these migrations.")]),s("h2",{id:"migrations-and-directus-schema"},[a("Migrations and Directus schema "),s("a",{class:"header-anchor",href:"#migrations-and-directus-schema"},"#")]),s("p",null,[a("Migrations can be used for managing contents of Directus collections (e.g. initial hydration). In order to do it, you must ensure that schema is up to date before running migrations. One way of achieving it is opting out of default "),s("code",{class:""},"directus bootstrap"),a(" process and running:")]),s("pre",null,[s("code",{class:"language-bash"},[a(`npx directus database install
`),s("span",{class:"hljs-comment"},"# notice that schema is applied before running migrations"),a(`
npx directus schema apply ./path/to/snapshot.yaml
npx directus database migrate:latest
`)])]),s("p",null,[a("You may want to add additional steps to reflect other responsibilities of "),s("code",{class:""},"directus bootstrap"),a(".")])],-1),d={title:"Custom Migrations",modularExtension:!1},u={name:"migrations",setup(p,{expose:t}){return t({frontmatter:{title:"Custom Migrations",modularExtension:!1}}),(h,m)=>{const n=o("docswrapper");return r(),l(n,{frontmatter:d},{default:i(()=>[c]),_:1})}}};typeof e=="function"&&e(u);export{u as default,d as frontmatter};
